# CWord ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-02-04
**æ¶æ„å¸ˆ**: Claude (Technical Expert & System Architect)
**æ–‡æ¡£çŠ¶æ€**: åˆç¨¿

---

## 1. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1.1 æ¶æ„æ¦‚è§ˆ

CWord é‡‡ç”¨**åˆ†å±‚æ¶æ„ + æ’ä»¶åŒ–æ™ºèƒ½ä½“**çš„è®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                  â”‚   CLI Interface     â”‚                    â”‚
â”‚                  â”‚  (Rich/Questionary) â”‚                    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Session Manager (ä¼šè¯ç®¡ç†)                  â”‚ â”‚
â”‚  â”‚  - Conversation State Machine                        â”‚ â”‚
â”‚  â”‚  - Decision Tracker                                  â”‚ â”‚
â”‚  â”‚  - Context Manager                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Agent Coordinator (æ™ºèƒ½ä½“åè°ƒå™¨)                  â”‚ â”‚
â”‚  â”‚  - Agent Selection Logic                             â”‚ â”‚
â”‚  â”‚  - Suggestion Engine                                 â”‚ â”‚
â”‚  â”‚  - Turn Management                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Document Generator (æ–‡æ¡£ç”Ÿæˆå™¨)                  â”‚ â”‚
â”‚  â”‚  - Real-time Preview                                 â”‚ â”‚
â”‚  â”‚  - Template Engine (Jinja2)                          â”‚ â”‚
â”‚  â”‚  - Markdown Formatter                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Agent Domain (æ™ºèƒ½ä½“é¢†åŸŸ)                   â”‚ â”‚
â”‚  â”‚  - Agent (Base Agent, Built-in Agents)               â”‚ â”‚
â”‚  â”‚  - AgentConfig (Configuration Loader)                â”‚ â”‚
â”‚  â”‚  - AgentContext (Individual Context)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Conversation Domain (å¯¹è¯é¢†åŸŸ)                 â”‚ â”‚
â”‚  â”‚  - Message (User/AI Message)                         â”‚ â”‚
â”‚  â”‚  - Turn (Conversation Turn)                          â”‚ â”‚
â”‚  â”‚  - Decision (Decision Record)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       Document Domain (æ–‡æ¡£é¢†åŸŸ)                      â”‚ â”‚
â”‚  â”‚  - DocumentTemplate (PRD/Tech Spec Templates)        â”‚ â”‚
â”‚  â”‚  - DocumentSection (Modular Sections)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       LLM Abstraction Layer (LLM æŠ½è±¡å±‚)              â”‚ â”‚
â”‚  â”‚  - LLM Provider Interface                            â”‚ â”‚
â”‚  â”‚  - Anthropic Provider                                â”‚ â”‚
â”‚  â”‚  - OpenAI Provider                                   â”‚ â”‚
â”‚  â”‚  - Local Model Provider (Ollama/LM Studio)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Storage Layer (å­˜å‚¨å±‚)                           â”‚ â”‚
â”‚  â”‚  - File System (JSON/YAML)                           â”‚ â”‚
â”‚  â”‚  - Session Store                                     â”‚ â”‚
â”‚  â”‚  - Config Manager                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Utilities (å·¥å…·åº“)                               â”‚ â”‚
â”‚  â”‚  - Logger (loguru)                                   â”‚ â”‚
â”‚  â”‚  - Event Bus                                         â”‚ â”‚
â”‚  â”‚  - Error Handler                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¶æ„è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | åº”ç”¨åœºæ™¯ |
|------|------|----------|
| **SOLID åŸåˆ™** | å•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ã€ä¾èµ–å€’ç½® | æ•´ä½“æ¶æ„è®¾è®¡ |
| **DRY åŸåˆ™** | Don't Repeat Yourselfï¼Œé¿å…é‡å¤ä»£ç  | å·¥å…·å‡½æ•°ã€é…ç½®ç®¡ç† |
| **æ’ä»¶åŒ–è®¾è®¡** | æ™ºèƒ½ä½“ä½œä¸ºæ’ä»¶ï¼Œå¯åŠ¨æ€åŠ è½½ | æ™ºèƒ½ä½“ç³»ç»Ÿ |
| **ä¾èµ–æ³¨å…¥** | é€šè¿‡ä¾èµ–æ³¨å…¥ç®¡ç† LLM Providerã€Storage | æ¨¡å—è§£è€¦ |
| **äº‹ä»¶é©±åŠ¨** | å…³é”®äº‹ä»¶ï¼ˆå¦‚å†³ç­–ã€æ¶ˆæ¯ï¼‰é€šè¿‡äº‹ä»¶æ€»çº¿ä¼ æ’­ | æ¨¡å—é—´é€šä¿¡ |
| **ç­–ç•¥æ¨¡å¼** | ä¸åŒçš„ LLM Provider ä½¿ç”¨ç»Ÿä¸€æ¥å£ | LLM æŠ½è±¡å±‚ |

### 1.3 æ ¸å¿ƒè®¾è®¡æ¨¡å¼

#### 1.3.1 ç­–ç•¥æ¨¡å¼ - LLM Provider

```python
# ç­–ç•¥æ¥å£
class LLMProvider(ABC):
    @abstractmethod
    async def generate(self, prompt: str, **kwargs) -> str:
        pass

    @abstractmethod
    async def generate_stream(self, prompt: str, **kwargs) -> AsyncIterator[str]:
        pass

# å…·ä½“ç­–ç•¥
class AnthropicProvider(LLMProvider):
    async def generate(self, prompt: str, **kwargs) -> str:
        # Anthropic API å®ç°
        pass

class OpenAIProvider(LLMProvider):
    async def generate(self, prompt: str, **kwargs) -> str:
        # OpenAI API å®ç°
        pass

# ä¸Šä¸‹æ–‡
class LLMContext:
    def __init__(self, provider: LLMProvider):
        self.provider = provider

    async def chat(self, agent: Agent, messages: List[Message]) -> str:
        return await self.provider.generate(...)
```

#### 1.3.2 å·¥å‚æ¨¡å¼ - Agent åˆ›å»º

```python
class AgentFactory:
    @staticmethod
    def create_agent(config: AgentConfig) -> Agent:
        agent_type = config.role

        if agent_type == "product_manager":
            return ProductManagerAgent(config)
        elif agent_type == "tech_lead":
            return TechLeadAgent(config)
        elif agent_type == "security_expert":
            return SecurityExpertAgent(config)
        else:
            return GenericAgent(config)
```

#### 1.3.3 è§‚å¯Ÿè€…æ¨¡å¼ - äº‹ä»¶ç³»ç»Ÿ

```python
class EventBus:
    def __init__(self):
        self._listeners = defaultdict(list)

    def subscribe(self, event_type: str, callback: Callable):
        self._listeners[event_type].append(callback)

    async def publish(self, event: Event):
        for callback in self._listeners[event.type]:
            await callback(event)

# ä½¿ç”¨ç¤ºä¾‹
event_bus.subscribe("decision_made", log_decision)
event_bus.subscribe("message_sent", update_context)
```

---

## 2. æŠ€æœ¯æ ˆé€‰å‹

### 2.1 ç¼–ç¨‹è¯­è¨€

**é€‰æ‹©**: **Python 3.10+**

**ç†ç”±**:
- âœ… ä¸°å¯Œçš„ AI/LLM ç”Ÿæ€ï¼ˆAnthropic SDK, OpenAI SDK, LangChainï¼‰
- âœ… å¼ºå¤§çš„æ–‡æœ¬å¤„ç†èƒ½åŠ›ï¼ˆå­—ç¬¦ä¸²ã€Markdownã€æ¨¡æ¿ï¼‰
- âœ… å¼‚æ­¥æ”¯æŒï¼ˆasyncioï¼Œé€‚åˆå¹¶å‘è°ƒç”¨å¤šä¸ª LLMï¼‰
- âœ… CLI å·¥å…·æˆç†Ÿï¼ˆRich, Questionary, Clickï¼‰
- âœ… å¿«é€Ÿå¼€å‘ï¼Œé€‚åˆ MVP
- âœ… ç¤¾åŒºæ´»è·ƒï¼Œé—®é¢˜å®¹æ˜“è§£å†³

**æ›¿ä»£æ–¹æ¡ˆè€ƒè™‘**:
- Rust: æ€§èƒ½æ›´å¥½ï¼Œä½†å¼€å‘é€Ÿåº¦æ…¢ï¼ŒLLM SDK æ”¯æŒä¸å¦‚ Python
- Go: å¹¶å‘ä¼˜ç§€ï¼Œä½† AI ç”Ÿæ€è¾ƒå¼±
- TypeScript: Node.js ç”Ÿæ€å¥½ï¼Œä½† Python åœ¨ AI é¢†åŸŸæ›´æˆç†Ÿ

### 2.2 CLI æ¡†æ¶

**é€‰æ‹©**: **Rich + Questionary**

| åº“ | ç”¨é€” | ç†ç”± |
|---|------|------|
| **Rich** | ç»ˆç«¯ç¾åŒ–ã€è¡¨æ ¼ã€è¿›åº¦æ¡ | åŠŸèƒ½å¼ºå¤§ï¼Œè¾“å‡ºç¾è§‚ï¼Œæ”¯æŒ Markdown æ¸²æŸ“ |
| **Questionary** | äº¤äº’å¼é—®ç­” | æ”¯æŒ rich é£æ ¼ï¼ŒAPI ç®€æ´ |
| **Click** (å¯é€‰) | å‘½ä»¤è¡Œå‚æ•°è§£æ | å¦‚éœ€å¤æ‚å­å‘½ä»¤å¯ä»¥è€ƒè™‘ |

**ä»£ç ç¤ºä¾‹**:
```python
from rich.console import Console
from rich.panel import Panel
from questionary import select

console = Console()

# ç¾åŒ–è¾“å‡º
console.print(Panel("ğŸ¯ CWord - æ‚¨çš„è™šæ‹Ÿäº§å“å›¢é˜Ÿ", style="bold blue"))

# äº¤äº’é€‰æ‹©
agent = select(
    "ğŸ¤ è°æƒ³å‘è¨€ï¼Ÿ",
    choices=[
        "äº§å“ç»ç†",
        "æŠ€æœ¯ä¸“å®¶",
        "å®‰å…¨ä¸“å®¶"
    ]
).ask()
```

### 2.3 LLM SDK

**é€‰æ‹©**: **å®˜æ–¹ SDK (Anthropic + OpenAI)**

```python
# requirements.txt
anthropic>=0.18.0
openai>=1.0.0
```

**ç†ç”±**:
- âœ… å®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šæ€§é«˜
- âœ… æ”¯æŒæµå¼è¾“å‡ºï¼ˆstream=Trueï¼‰
- âœ… ç±»å‹æç¤ºå®Œå–„
- âœ… é”™è¯¯å¤„ç†å®Œå–„

**é›†æˆæ–¹æ¡ˆ**:
```python
from anthropic import Anthropic
from openai import AsyncOpenAI

class LLMProviderFactory:
    @staticmethod
    def create_provider(config: ProviderConfig) -> LLMProvider:
        if config.provider == "anthropic":
            client = Anthropic(api_key=config.api_key)
            return AnthropicProvider(client, config.model)
        elif config.provider == "openai":
            client = AsyncOpenAI(api_key=config.api_key)
            return OpenAIProvider(client, config.model)
```

### 2.4 é…ç½®ç®¡ç†

**é€‰æ‹©**: **PyYAML**

```python
# requirements.txt
pyyaml>=6.0
```

**ç†ç”±**:
- âœ… YAML å¯è¯»æ€§å¥½ï¼Œæ˜“äºç¼–è¾‘
- âœ… Python æ ‡å‡†åº“æ”¯æŒ
- âœ… æ”¯æŒå¤æ‚é…ç½®ï¼ˆåµŒå¥—ã€åˆ—è¡¨ï¼‰

**æ›¿ä»£æ–¹æ¡ˆ**:
- JSON: å¯è¯»æ€§å·®ï¼Œä¸æ”¯æŒæ³¨é‡Š
- TOML: ä¸é”™ï¼Œä½† YAML æ›´çµæ´»
- Python ConfigParser: ä¸æ”¯æŒåµŒå¥—

### 2.5 æ¨¡æ¿å¼•æ“

**é€‰æ‹©**: **Jinja2**

```python
# requirements.txt
jinja2>=3.1.0
```

**ç†ç”±**:
- âœ… åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒç»§æ‰¿ã€å®ã€è¿‡æ»¤å™¨
- âœ… è¯­æ³•æ¸…æ™°ï¼ˆ`{{ variable }}`, `{% block %}`ï¼‰
- âœ… å¹¿æ³›ä½¿ç”¨ï¼ˆFlask, Ansible ç­‰ï¼‰
- âœ… é€‚åˆç”Ÿæˆ Markdown æ–‡æ¡£

**ä»£ç ç¤ºä¾‹**:
```python
from jinja2 import Template

template = Template("""
# {{ product_name }} äº§å“éœ€æ±‚æ–‡æ¡£

## 1. äº§å“æ¦‚è¿°
{{ description }}

## 2. ç”¨æˆ·ç”»åƒ
{% for user in users %}
- {{ user.name }}: {{ user.description }}
{% endfor %}
""")

output = template.render(
    product_name="å‘ç¥¨ç®¡ç†ç³»ç»Ÿ",
    description="è‡ªåŠ¨åŒ–å‘ç¥¨å¤„ç†...",
    users=[...]
)
```

### 2.6 æ•°æ®å­˜å‚¨

**é€‰æ‹©**: **JSON æ–‡ä»¶ + SQLite (å¯é€‰)**

| å­˜å‚¨ç±»å‹ | ç”¨é€” | ç†ç”± |
|---------|------|------|
| **JSON** | ä¼šè¯å†å²ã€å†³ç­–è®°å½• | ç®€å•ã€æ˜“è¯»ã€æ˜“è°ƒè¯• |
| **YAML** | é…ç½®æ–‡ä»¶ | å¯è¯»æ€§å¥½ |
| **SQLite** (å¯é€‰) | å¤§è§„æ¨¡ä¼šè¯å­˜å‚¨ | å¦‚éœ€æŸ¥è¯¢ã€ç´¢å¼• |

**ä»£ç ç¤ºä¾‹**:
```python
import json
from pathlib import Path

class SessionStore:
    def save_session(self, session_id: str, data: dict):
        path = Path.home() / ".cword" / "sessions" / f"{session_id}.json"
        path.parent.mkdir(parents=True, exist_ok=True)
        path.write_text(json.dumps(data, indent=2, ensure_ascii=False))

    def load_session(self, session_id: str) -> dict:
        path = Path.home() / ".cword" / "sessions" / f"{session_id}.json"
        return json.loads(path.read_text())
```

### 2.7 æ—¥å¿—ç³»ç»Ÿ

**é€‰æ‹©**: **Loguru**

```python
# requirements.txt
loguru>=0.7.0
```

**ç†ç”±**:
- âœ… API ç®€æ´ï¼ˆæ¯”æ ‡å‡†åº“ logging æ˜“ç”¨ï¼‰
- âœ… è‡ªåŠ¨æ—¥å¿—è½®è½¬
- âœ… å½©è‰²è¾“å‡º
- âœ… å¼‚å¸¸æ•è·å®Œå–„

**ä»£ç ç¤ºä¾‹**:
```python
from loguru import logger

logger.add(".cword/logs/cword_{time}.log", rotation="10 MB")
logger.info("CWord å¯åŠ¨")
logger.error("LLM API è°ƒç”¨å¤±è´¥", error=str(e))
```

### 2.8 å¼‚æ­¥æ¡†æ¶

**é€‰æ‹©**: **asyncio (Python æ ‡å‡†åº“)**

**ç†ç”±**:
- âœ… Python å†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–
- âœ… é€‚åˆ IO å¯†é›†å‹ä»»åŠ¡ï¼ˆLLM API è°ƒç”¨ï¼‰
- âœ… å¯å¹¶å‘å¤„ç†å¤šä¸ªæ™ºèƒ½ä½“

**ä»£ç ç¤ºä¾‹**:
```python
import asyncio

async def let_agents_speak(agent: Agent, message: str) -> str:
    response = await agent.generate(message)
    return response

# å¹¶å‘è°ƒç”¨å¤šä¸ªæ™ºèƒ½ä½“
results = await asyncio.gather(
    let_agents_speak(product_manager, user_message),
    let_agents_speak(tech_lead, user_message),
)
```

### 2.9 å®Œæ•´ä¾èµ–æ¸…å•

```txt
# requirements.txt

# LLM SDKs
anthropic>=0.18.0
openai>=1.0.0

# CLI
rich>=13.7.0
questionary>=2.0.0

# Configuration
pyyaml>=6.0

# Template Engine
jinja2>=3.1.0

# Logging
loguru>=0.7.0

# Utilities
python-dotenv>=1.0.0  # ç¯å¢ƒå˜é‡ç®¡ç†
aiofiles>=23.0.0      # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
pydantic>=2.0.0       # æ•°æ®éªŒè¯

# Optional (for V2)
fastapi>=0.100.0      # Web UI
uvicorn>=0.23.0       # ASGI Server
```

---

## 3. æ ¸å¿ƒæ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 é¡¹ç›®ç›®å½•ç»“æ„

```
cword/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # CLI å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                    # CLI ç•Œé¢å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ interface.py        # ä¸»ç•Œé¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ commands.py         # CLI å‘½ä»¤å¤„ç†
â”‚   â”‚   â””â”€â”€ formatters.py       # è¾“å‡ºæ ¼å¼åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ session.py          # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ coordinator.py      # æ™ºèƒ½ä½“åè°ƒå™¨
â”‚   â”‚   â”œâ”€â”€ decision_tracker.py # å†³ç­–è¿½è¸ª
â”‚   â”‚   â””â”€â”€ context_manager.py  # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                 # æ™ºèƒ½ä½“ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # åŸºç¡€æ™ºèƒ½ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ factory.py          # æ™ºèƒ½ä½“å·¥å‚
â”‚   â”‚   â”œâ”€â”€ built_in/           # å†…ç½®æ™ºèƒ½ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ product_manager.py
â”‚   â”‚   â”‚   â”œâ”€â”€ tech_lead.py
â”‚   â”‚   â”‚   â”œâ”€â”€ business_consultant.py
â”‚   â”‚   â”‚   â””â”€â”€ security_expert.py
â”‚   â”‚   â””â”€â”€ config.py           # æ™ºèƒ½ä½“é…ç½®åŠ è½½
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/                    # LLM æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # LLM Provider åŸºç±»
â”‚   â”‚   â”œâ”€â”€ providers.py        # å…·ä½“æä¾›å•†å®ç°
â”‚   â”‚   â””â”€â”€ prompt_manager.py   # Prompt æ¨¡æ¿ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ documents/              # æ–‡æ¡£ç”Ÿæˆå¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ generator.py        # æ–‡æ¡£ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ templates/          # Jinja2 æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ prd_template.md
â”‚   â”‚   â”‚   â”œâ”€â”€ tech_spec_template.md
â”‚   â”‚   â”‚   â””â”€â”€ decision_record_template.md
â”‚   â”‚   â””â”€â”€ sections.py         # æ–‡æ¡£ç« èŠ‚å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ session_store.py    # ä¼šè¯å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ config_store.py     # é…ç½®å­˜å‚¨
â”‚   â”‚   â””â”€â”€ document_store.py   # æ–‡æ¡£å­˜å‚¨
â”‚   â”‚
â”‚   â””â”€â”€ utils/                  # å·¥å…·åº“
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ event_bus.py        # äº‹ä»¶æ€»çº¿
â”‚       â”œâ”€â”€ logger.py           # æ—¥å¿—é…ç½®
â”‚       â””â”€â”€ helpers.py          # è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ agents.yaml             # æ™ºèƒ½ä½“é…ç½®ï¼ˆé»˜è®¤ï¼‰
â”‚   â””â”€â”€ cword.yaml              # å…¨å±€é…ç½®
â”‚
â”œâ”€â”€ templates/                  # æ–‡æ¡£æ¨¡æ¿ï¼ˆç”¨æˆ·å¯è‡ªå®šä¹‰ï¼‰
â”‚   â”œâ”€â”€ prd_template.md
â”‚   â”œâ”€â”€ tech_spec_template.md
â”‚   â””â”€â”€ decision_record_template.md
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_agents.py
â”‚   â”œâ”€â”€ test_coordinator.py
â”‚   â””â”€â”€ test_generator.py
â”‚
â”œâ”€â”€ requirements.txt            # ä¾èµ–
â”œâ”€â”€ setup.py                    # å®‰è£…è„šæœ¬
â”œâ”€â”€ README.md
â””â”€â”€ PRD.md                      # äº§å“éœ€æ±‚æ–‡æ¡£
```

### 3.2 æ¨¡å—èŒè´£åˆ’åˆ†

| æ¨¡å— | èŒè´£ | å¯¹å¤–æ¥å£ |
|------|------|----------|
| **cli/** | CLI äº¤äº’ã€å‘½ä»¤è§£æã€ç”¨æˆ·è¾“å…¥å¤„ç† | `CLIInterface` |
| **core/** | ä¼šè¯çŠ¶æ€ç®¡ç†ã€æ™ºèƒ½ä½“è°ƒåº¦ã€å†³ç­–è®°å½• | `SessionManager`, `AgentCoordinator` |
| **agents/** | æ™ºèƒ½ä½“æŠ½è±¡ã€å…·ä½“å®ç°ã€é…ç½®åŠ è½½ | `Agent`, `AgentFactory` |
| **llm/** | LLM API è°ƒç”¨ã€æµå¼è¾“å‡ºã€é”™è¯¯å¤„ç† | `LLMProvider` |
| **documents/** | æ–‡æ¡£ç”Ÿæˆã€æ¨¡æ¿æ¸²æŸ“ã€å®æ—¶é¢„è§ˆ | `DocumentGenerator` |
| **storage/** | æ•°æ®æŒä¹…åŒ–ã€é…ç½®ç®¡ç†ã€æ–‡ä»¶æ“ä½œ | `SessionStore`, `ConfigStore` |
| **utils/** | äº‹ä»¶ç³»ç»Ÿã€æ—¥å¿—ã€é€šç”¨å·¥å…· | `EventBus`, `Logger` |

### 3.3 æ ¸å¿ƒç±»è®¾è®¡

#### 3.3.1 Sessionï¼ˆä¼šè¯ï¼‰

```python
from dataclasses import dataclass, field
from typing import List, Optional
from datetime import datetime

@dataclass
class Message:
    """å•æ¡æ¶ˆæ¯"""
    role: str  # "user" æˆ– "agent"
    agent_name: Optional[str] = None  # å¦‚æœæ˜¯æ™ºèƒ½ä½“ï¼Œè®°å½•åç§°
    content: str = ""
    timestamp: datetime = field(default_factory=datetime.now)

    def to_dict(self) -> dict:
        return {
            "role": self.role,
            "agent_name": self.agent_name,
            "content": self.content,
            "timestamp": self.timestamp.isoformat()
        }

@dataclass
class Decision:
    """å†³ç­–è®°å½•"""
    id: str
    topic: str
    decision: str
    participants: List[str]
    reasoning: str
    timestamp: datetime = field(default_factory=datetime.now)

@dataclass
class Session:
    """ä¼šè¯çŠ¶æ€"""
    session_id: str
    product_name: str = ""
    messages: List[Message] = field(default_factory=list)
    decisions: List[Decision] = field(default_factory=list)
    current_stage: str = "initial"  # initial, requirements, design, complete
    metadata: dict = field(default_factory=dict)

    def add_message(self, message: Message):
        self.messages.append(message)

    def add_decision(self, decision: Decision):
        self.decisions.append(decision)

    def get_context_summary(self, max_tokens: int = 4000) -> str:
        """è·å–ä¸Šä¸‹æ–‡æ‘˜è¦ï¼ˆç”¨äº LLM è°ƒç”¨ï¼‰"""
        # å®ç°ä¸Šä¸‹æ–‡å‹ç¼©é€»è¾‘
        pass
```

#### 3.3.2 Agentï¼ˆæ™ºèƒ½ä½“åŸºç±»ï¼‰

```python
from abc import ABC, abstractmethod
from typing import List, Dict, Any

class AgentConfig:
    """æ™ºèƒ½ä½“é…ç½®"""
    def __init__(self, config_dict: dict):
        self.name = config_dict["name"]
        self.role = config_dict["role"]
        self.description = config_dict["description"]
        self.system_prompt = config_dict["system_prompt"]
        self.model_config = config_dict["model"]

class Agent(ABC):
    """æ™ºèƒ½ä½“åŸºç±»"""

    def __init__(self, config: AgentConfig, llm_provider: LLMProvider):
        self.config = config
        self.llm = llm_provider
        self.name = config.name
        self.role = config.role

    @abstractmethod
    async def generate_response(
        self,
        conversation_history: List[Message],
        context: dict
    ) -> str:
        """ç”Ÿæˆå›å¤"""
        pass

    def build_prompt(self, conversation_history: List[Message]) -> str:
        """æ„å»º Promptï¼ˆå­ç±»å¯è¦†ç›–ï¼‰"""
        prompt = f"ä½ æ˜¯{self.name}ï¼Œ{self.config.description}\n\n"
        prompt += "å¯¹è¯å†å²ï¼š\n"
        for msg in conversation_history[-10:]:  # åªå–æœ€è¿‘ 10 æ¡
            role = msg.agent_name if msg.role == "agent" else "ç”¨æˆ·"
            prompt += f"{role}: {msg.content}\n"
        prompt += f"\nè¯·ä»¥{self.name}çš„èº«ä»½å›å¤ï¼š"
        return prompt

# å…·ä½“æ™ºèƒ½ä½“ç¤ºä¾‹
class ProductManagerAgent(Agent):
    """äº§å“ç»ç†æ™ºèƒ½ä½“"""

    def __init__(self, config: AgentConfig, llm_provider: LLMProvider):
        super().__init__(config, llm_provider)

    async def generate_response(
        self,
        conversation_history: List[Message],
        context: dict
    ) -> str:
        prompt = self.build_prompt(conversation_history)

        # æ·»åŠ äº§å“ç»ç†ç‰¹å®šçš„æŒ‡ä»¤
        if context.get("stage") == "initial":
            prompt += "\n\nè¯·æ³¨æ„ï¼šè¿™æ˜¯å¯¹è¯åˆæœŸï¼Œä½ åº”è¯¥å¤šæé—®ï¼ŒæŒ–æ˜ç”¨æˆ·éœ€æ±‚ã€‚"
        elif context.get("stage") == "requirements":
            prompt += "\n\nè¯·æ³¨æ„ï¼šéœ€æ±‚è®¨è®ºé˜¶æ®µï¼Œè¯·æ€»ç»“ç¡®è®¤éœ€æ±‚ã€‚"

        return await self.llm.generate(prompt)

class SecurityExpertAgent(Agent):
    """å®‰å…¨ä¸“å®¶æ™ºèƒ½ä½“"""

    def build_prompt(self, conversation_history: List[Message]) -> str:
        prompt = super().build_prompt(conversation_history)

        # å®‰å…¨ä¸“å®¶ç‰¹æœ‰çš„æŒ‡ä»¤
        prompt += "\n\nç‰¹åˆ«æ³¨æ„ï¼šä½ éœ€è¦ä¸»åŠ¨è´¨ç–‘ä¸å®‰å…¨çš„è®¾è®¡ï¼Œæé†’ç”¨æˆ·é£é™©ã€‚"

        return prompt
```

#### 3.3.3 AgentCoordinatorï¼ˆæ™ºèƒ½ä½“åè°ƒå™¨ï¼‰

```python
class AgentCoordinator:
    """æ™ºèƒ½ä½“åè°ƒå™¨"""

    def __init__(self, agents: List[Agent]):
        self.agents = {agent.name: agent for agent in agents}
        self.event_bus = EventBus()

    async def let_agent_speak(
        self,
        agent_name: str,
        session: Session
    ) -> str:
        """è®©æŒ‡å®šæ™ºèƒ½ä½“å‘è¨€"""
        agent = self.agents.get(agent_name)
        if not agent:
            raise ValueError(f"æ™ºèƒ½ä½“ {agent_name} ä¸å­˜åœ¨")

        # æ„å»ºä¸Šä¸‹æ–‡
        context = {
            "stage": session.current_stage,
            "decisions": session.decisions,
            "product_name": session.product_name
        }

        # ç”Ÿæˆå›å¤
        response = await agent.generate_response(
            session.messages,
            context
        )

        # è®°å½•æ¶ˆæ¯
        message = Message(
            role="agent",
            agent_name=agent_name,
            content=response
        )
        session.add_message(message)

        # å‘å¸ƒäº‹ä»¶
        await self.event_bus.publish(Event(
            type="agent_spoke",
            data={"agent": agent_name, "response": response}
        ))

        return response

    async def suggest_agents(self, session: Session) -> List[str]:
        """æ™ºèƒ½å»ºè®®å“ªäº›æ™ºèƒ½ä½“åº”è¯¥å‘è¨€"""
        suggestions = []

        # è§„åˆ™ 1: å¦‚æœæ¶‰åŠæ•æ„Ÿæ•°æ®ï¼Œå»ºè®®å®‰å…¨ä¸“å®¶
        last_message = session.messages[-1].content.lower()
        sensitive_keywords = ["èº«ä»½è¯", "å¯†ç ", "é“¶è¡Œå¡", "éšç§", "æ•°æ®"]
        if any(keyword in last_message for keyword in sensitive_keywords):
            suggestions.append("å®‰å…¨ä¸“å®¶")

        # è§„åˆ™ 2: å¦‚æœæ˜¯åˆæœŸé˜¶æ®µï¼Œå»ºè®®äº§å“ç»ç†
        if session.current_stage == "initial" and len(session.messages) < 5:
            suggestions.append("äº§å“ç»ç†")

        # è§„åˆ™ 3: å¦‚æœå¼€å§‹è®¨è®ºæŠ€æœ¯ï¼Œå»ºè®®æŠ€æœ¯ä¸“å®¶
        tech_keywords = ["æ¶æ„", "æ•°æ®åº“", "api", "æ¡†æ¶", "æŠ€æœ¯"]
        if any(keyword in last_message for keyword in tech_keywords):
            suggestions.append("æŠ€æœ¯ä¸“å®¶")

        return suggestions

    async def should_confirm_decision(self, session: Session) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥ç¡®è®¤å†³ç­–"""
        # æ¯ 5 è½®å¯¹è¯åç¡®è®¤
        if len(session.messages) % 5 == 0:
            return True

        # å¦‚æœæ£€æµ‹åˆ°å†³ç­–æ€§è¯­è¨€
        last_message = session.messages[-1].content.lower()
        decision_keywords = ["å°±ç”¨", "é€‰æ‹©", "ç¡®å®š", "å†³å®š"]
        return any(keyword in last_message for keyword in decision_keywords)
```

#### 3.3.4 DocumentGeneratorï¼ˆæ–‡æ¡£ç”Ÿæˆå™¨ï¼‰

```python
from jinja2 import Environment, FileSystemLoader

class DocumentGenerator:
    """æ–‡æ¡£ç”Ÿæˆå™¨"""

    def __init__(self, template_dir: str):
        self.env = Environment(loader=FileSystemLoader(template_dir))
        self.event_bus = EventBus()

    async def generate_prd(self, session: Session) -> str:
        """ç”Ÿæˆ PRD æ–‡æ¡£"""
        template = self.env.get_template("prd_template.md")

        # æå–ç»“æ„åŒ–ä¿¡æ¯
        product_info = self._extract_product_info(session)
        user_stories = self._extract_user_stories(session)
        features = self._extract_features(session)

        # æ¸²æŸ“æ¨¡æ¿
        content = template.render(
            product_name=session.product_name,
            product_info=product_info,
            user_stories=user_stories,
            features=features,
            decisions=session.decisions
        )

        return content

    async def generate_tech_spec(self, session: Session) -> str:
        """ç”ŸæˆæŠ€æœ¯è®¾è®¡æ–‡æ¡£"""
        template = self.env.get_template("tech_spec_template.md")

        tech_decisions = [d for d in session.decisions if "æŠ€æœ¯" in d.topic]
        architecture = self._infer_architecture(session)

        content = template.render(
            product_name=session.product_name,
            architecture=architecture,
            tech_decisions=tech_decisions
        )

        return content

    def _extract_product_info(self, session: Session) -> dict:
        """ä»å¯¹è¯ä¸­æå–äº§å“ä¿¡æ¯"""
        # ä½¿ç”¨ LLM æå–ç»“æ„åŒ–ä¿¡æ¯
        prompt = f"""
        ä»ä»¥ä¸‹å¯¹è¯ä¸­æå–äº§å“ä¿¡æ¯ï¼š
        {self._format_conversation(session)}

        è¯·æå–ï¼š
        1. äº§å“åç§°
        2. ç›®æ ‡ç”¨æˆ·
        3. æ ¸å¿ƒä»·å€¼
        4. ä¸»è¦åŠŸèƒ½

        ä»¥ JSON æ ¼å¼è¿”å›ã€‚
        """

        # è°ƒç”¨ LLMï¼ˆçœç•¥å®ç°ï¼‰
        # result = llm.generate(prompt)
        # return json.loads(result)

        return {"name": "...", "users": [...], "value": "...", "features": [...]}

    async def generate_realtime_preview(self, session: Session) -> str:
        """ç”Ÿæˆå®æ—¶é¢„è§ˆï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        preview = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“„ æ–‡æ¡£é¢„è§ˆ (PRD - äº§å“éœ€æ±‚æ–‡æ¡£)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## 1. äº§å“æ¦‚è¿°
- äº§å“åç§°ï¼š{session.product_name or '(å¾…ç¡®å®š)'}

## 2. éœ€æ±‚åˆ†æ
### 2.1 ç”¨æˆ·åœºæ™¯
{self._extract_user_scenarios(session)}

### 2.2 åŠŸèƒ½éœ€æ±‚
{self._extract_features_summary(session)}

## 3. æŠ€æœ¯æ–¹æ¡ˆ
{self._extract_tech_summary(session)}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""
        return preview
```

---

## 4. æ•°æ®æ¨¡å‹ä¸å­˜å‚¨è®¾è®¡

### 4.1 é…ç½®æ–‡ä»¶ç»“æ„

#### 4.1.1 å…¨å±€é…ç½®ï¼ˆcword.yamlï¼‰

```yaml
# config/cword.yaml

# åº”ç”¨é…ç½®
app:
  name: "CWord"
  version: "1.0.0"
  log_level: "INFO"

# ç›®å½•é…ç½®
directories:
  sessions: "~/.cword/sessions"
  logs: "~/.cword/logs"
  output: "~/.cword/output"
  templates: "~/.cword/templates"

# é»˜è®¤æ¨¡å‹é…ç½®
default_model:
  provider: "anthropic"
  api_key_env: "ANTHROPIC_API_KEY"  # ä»ç¯å¢ƒå˜é‡è¯»å–
  base_url: "https://api.anthropic.com"
  model: "claude-sonnet-4-5-20250929"
  temperature: 0.7
  max_tokens: 2000
  timeout: 30  # ç§’

# å¯¹è¯é…ç½®
conversation:
  max_history: 50  # ä¿ç•™æœ€è¿‘ 50 æ¡æ¶ˆæ¯
  summary_interval: 10  # æ¯ 10 è½®ç”Ÿæˆæ‘˜è¦
  auto_save_interval: 300  # æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜

# æ–‡æ¡£é…ç½®
documents:
  format: "markdown"
  include_decision_history: true
  include_conversation_summary: true
  auto_export: false  # å¯¹è¯ç»“æŸæ—¶è‡ªåŠ¨å¯¼å‡º

# æ™ºèƒ½ä½“é…ç½®æ–‡ä»¶è·¯å¾„
agents_config: "config/agents.yaml"
```

#### 4.1.2 æ™ºèƒ½ä½“é…ç½®ï¼ˆagents.yamlï¼‰

```yaml
# config/agents.yaml

default_model:
  provider: "anthropic"
  api_key_env: "ANTHROPIC_API_KEY"
  model: "claude-sonnet-4-5-20250929"
  temperature: 0.7
  max_tokens: 2000

agents:
  - name: "äº§å“ç»ç†"
    role: "product_manager"
    emoji: "ğŸ¯"
    description: "ç»éªŒä¸°å¯Œçš„äº§å“ç»ç†ï¼Œæ“…é•¿éœ€æ±‚æŒ–æ˜å’Œç”¨æˆ·æ•…äº‹"
    system_prompt: |
      ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„äº§å“ç»ç†ï¼Œä½ çš„èŒè´£æ˜¯ï¼š
      1. é€šè¿‡æé—®æŒ–æ˜ç”¨æˆ·çš„çœŸå®éœ€æ±‚
      2. å°†æ¨¡ç³Šçš„æƒ³æ³•è½¬åŒ–ä¸ºæ¸…æ™°çš„åŠŸèƒ½æè¿°
      3. è¯†åˆ«ç”¨æˆ·æœªæåŠä½†é‡è¦çš„ç»†èŠ‚
      4. å®šæœŸæ€»ç»“ç¡®è®¤éœ€æ±‚

      å‘è¨€é£æ ¼ï¼š
      - å–„äºæé—®ï¼Œå¤šé—®"ä¸ºä»€ä¹ˆ"å’Œ"å…·ä½“åœºæ™¯"
      - æä¾›é€‰é¡¹è®©ç”¨æˆ·é€‰æ‹©ï¼ˆA/B æ–¹æ¡ˆï¼‰
      - ç”¨è¯ç®€æ´ï¼Œé¿å…æŠ€æœ¯æœ¯è¯­
      - æ¯æ¬¡å‘è¨€æ§åˆ¶åœ¨ 200 å­—ä»¥å†…

      é‡è¦æç¤ºï¼š
      - ä¸è¦ä¸€æ¬¡æ€§é—®å¤ªå¤šé—®é¢˜ï¼Œæ¯æ¬¡ 2-3 ä¸ª
      - ç”¨æˆ·å›ç­”åï¼Œç»™äºˆç§¯æåé¦ˆ
      - å®šæœŸæ€»ç»“ï¼Œç¡®è®¤ç†è§£æ­£ç¡®
    model:
      provider: "anthropic"
      model: "claude-sonnet-4-5-20250929"
      temperature: 0.7

  - name: "æŠ€æœ¯ä¸“å®¶"
    role: "tech_lead"
    emoji: "ğŸ”§"
    description: "èµ„æ·±æŠ€æœ¯ä¸“å®¶ï¼Œæ“…é•¿æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹"
    system_prompt: |
      ä½ æ˜¯ä¸€ä½èµ„æ·±æŠ€æœ¯ä¸“å®¶ï¼Œä½ çš„èŒè´£æ˜¯ï¼š
      1. è¯„ä¼°æŠ€æœ¯å¯è¡Œæ€§
      2. æä¾›å¤šä¸ªæŠ€æœ¯æ–¹æ¡ˆå¹¶è§£é‡Šåˆ©å¼Š
      3. æ¨èåˆé€‚çš„æŠ€æœ¯æ ˆ
      4. ä¼°ç®—å¼€å‘æˆæœ¬å’Œå¤æ‚åº¦

      å‘è¨€é£æ ¼ï¼š
      - æä¾›è‡³å°‘ 2 ä¸ªæŠ€æœ¯æ–¹æ¡ˆ
      - ç”¨è¡¨æ ¼å¯¹æ¯”æ–¹æ¡ˆä¼˜åŠ£
      - è€ƒè™‘æˆæœ¬ã€å¤æ‚åº¦ã€å¯ç»´æŠ¤æ€§
      - é¿å…è¿‡åº¦è®¾è®¡ï¼Œæ¨èæœ€ç®€æ–¹æ¡ˆ

      é‡è¦æç¤ºï¼š
      - å…ˆäº†è§£ç”¨æˆ·èƒŒæ™¯ï¼Œå†æ¨èæ–¹æ¡ˆ
      - è§£é‡ŠæŠ€æœ¯æœ¯è¯­ï¼Œå‡è®¾ç”¨æˆ·ä¸æ˜¯ä¸“å®¶
      - è€ƒè™‘ MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰
    model:
      provider: "anthropic"
      model: "claude-sonnet-4-5-20250929"
      temperature: 0.5

  - name: "å®‰å…¨ä¸“å®¶"
    role: "security_expert"
    emoji: "ğŸ›¡ï¸"
    description: "å®‰å…¨ä¸“å®¶ï¼Œæ“…é•¿è¯†åˆ«é£é™©å’Œéšç§é—®é¢˜"
    system_prompt: |
      ä½ æ˜¯ä¸€ä½å®‰å…¨ä¸“å®¶ï¼Œä½ çš„èŒè´£æ˜¯ï¼š
      1. è¯†åˆ«å®‰å…¨é£é™©å’Œéšç§é—®é¢˜
      2. è´¨ç–‘ä¸å®‰å…¨çš„è®¾è®¡
      3. æä¾›å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ
      4. æé†’åˆè§„æ€§é—®é¢˜

      å‘è¨€é£æ ¼ï¼š
      - ç”¨"ç­‰ç­‰"æˆ–"âš ï¸"å¼•èµ·æ³¨æ„
      - æ˜ç¡®æŒ‡å‡ºé£é™©ç‚¹å’Œæ½œåœ¨é—®é¢˜
      - æä¾›å»ºè®¾æ€§çš„æ”¹è¿›å»ºè®®
      - ä¸è¿‡åˆ†å¦å®šï¼Œç»™å‡ºå¯æ‰§è¡Œæ–¹æ¡ˆ

      é‡è¦æç¤ºï¼š
      - ä¸»åŠ¨è´¨ç–‘ï¼Œä¸è¦ç­‰åˆ«äººé—®ä½ 
      - æä¾›å…·ä½“çš„å®‰å…¨æªæ–½
      - è€ƒè™‘æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€åˆè§„æ€§
    model:
      provider: "anthropic"
      model: "claude-opus-4-5-20251101"  # ç”¨æ›´å¼ºçš„æ¨¡å‹
      temperature: 0.3

  - name: "ä¸šåŠ¡é¡¾é—®"
    role: "business_consultant"
    emoji: "ğŸ’¼"
    description: "å•†ä¸šä»·å€¼åˆ†æå¸ˆï¼Œæ“…é•¿åœºæ™¯æ‰©å±•å’Œå¸‚åœºåˆ†æ"
    system_prompt: |
      ä½ æ˜¯ä¸€ä½ä¸šåŠ¡é¡¾é—®ï¼Œä½ çš„èŒè´£æ˜¯ï¼š
      1. åˆ†æäº§å“çš„å•†ä¸šä»·å€¼
      2. æ‰©å±•ä½¿ç”¨åœºæ™¯
      3. è€ƒè™‘ç«å“å’Œå¸‚åœºå®šä½
      4. æé†’ç”¨æˆ·æœªè€ƒè™‘çš„æœºä¼š

      å‘è¨€é£æ ¼ï¼š
      - ä»ç”¨æˆ·ä»·å€¼è§’åº¦æ€è€ƒ
      - æä¾›å¸‚åœºå‚è€ƒï¼ˆå¦‚"ç±»ä¼¼äº§å“æœ‰..."ï¼‰
      - è€ƒè™‘å•†ä¸šæ¨¡å¼å’Œå˜ç°
      - é¼“åŠ±ç”¨æˆ·æ€è€ƒé•¿æœŸè§„åˆ’
    model:
      provider: "anthropic"
      model: "claude-sonnet-4-5-20250929"
      temperature: 0.7
```

### 4.2 ä¼šè¯å­˜å‚¨æ ¼å¼

**æ–‡ä»¶è·¯å¾„**: `~/.cword/sessions/{session_id}.json`

```json
{
  "session_id": "invoice_system_20250204_143022",
  "created_at": "2025-02-04T14:30:22",
  "updated_at": "2025-02-04T15:45:10",
  "product_name": "å‘ç¥¨ç®¡ç†ç³»ç»Ÿ",
  "current_stage": "requirements",
  "messages": [
    {
      "role": "user",
      "content": "æˆ‘æƒ³åšä¸ªå‘ç¥¨ç®¡ç†ç³»ç»Ÿ",
      "timestamp": "2025-02-04T14:30:25"
    },
    {
      "role": "agent",
      "agent_name": "äº§å“ç»ç†",
      "content": "å¥½çš„ï¼æˆ‘æƒ³å…ˆäº†è§£ä¸€ä¸‹...",
      "timestamp": "2025-02-04T14:30:28"
    }
  ],
  "decisions": [
    {
      "id": "decision_001",
      "topic": "æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©",
      "decision": "ä½¿ç”¨è½»é‡çº§æ–¹æ¡ˆï¼ˆSQLite + æœ¬åœ° OCRï¼‰",
      "participants": ["æŠ€æœ¯ä¸“å®¶", "å®‰å…¨ä¸“å®¶"],
      "reasoning": "ä¸ªäººä½¿ç”¨ï¼Œæ•°æ®é‡å°ï¼Œæˆæœ¬æ§åˆ¶",
      "timestamp": "2025-02-04T14:35:10"
    }
  ],
  "metadata": {
    "user_profile": {
      "technical_background": "éæŠ€æœ¯èƒŒæ™¯",
      "industry": "è¿è¥å•†",
      "goal": "é™æœ¬å¢æ•ˆ"
    },
    "context_summary": "ç”¨æˆ·æƒ³åšä¸ªäººå‘ç¥¨ç®¡ç†ç³»ç»Ÿï¼Œä¸»è¦éœ€æ±‚æ˜¯..."
  }
}
```

### 4.3 æ–‡æ¡£è¾“å‡ºæ ¼å¼

#### 4.3.1 PRD æ¨¡æ¿ï¼ˆprd_template.mdï¼‰

```markdown
# {{ product_name }} äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

**ç”Ÿæˆæ—¶é—´**: {{ generated_at }}
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0

---

## 1. äº§å“æ¦‚è¿°

### 1.1 äº§å“èƒŒæ™¯
{{ product_background }}

### 1.2 ç›®æ ‡ç”¨æˆ·
{% for user in target_users %}
- **{{ user.name }}**: {{ user.description }}
{% endfor %}

### 1.3 æ ¸å¿ƒä»·å€¼
{{ core_value }}

---

## 2. ç”¨æˆ·æ•…äº‹

### 2.1 ç”¨æˆ·ç”»åƒ
{{ user_persona }}

### 2.2 ä½¿ç”¨åœºæ™¯
{% for scenario in scenarios %}
#### åœºæ™¯ {{ loop.index }}: {{ scenario.title }}
- **ç”¨æˆ·**: {{ scenario.user }}
- **ç›®æ ‡**: {{ scenario.goal }}
- **ç—›ç‚¹**: {{ scenario.pain_point }}
- **è§£å†³æ–¹æ¡ˆ**: {{ scenario.solution }}
{% endfor %}

### 2.3 ç”¨æˆ·æ—…ç¨‹
{{ user_journey }}

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 æ ¸å¿ƒåŠŸèƒ½ (P0)
{% for feature in p0_features %}
#### {{ feature.name }}
- **åŠŸèƒ½æè¿°**: {{ feature.description }}
- **ç”¨æˆ·ä»·å€¼**: {{ feature.value }}
- **éªŒæ”¶æ ‡å‡†**: {{ feature.acceptance_criteria }}
{% endfor %}

### 3.2 è¾…åŠ©åŠŸèƒ½ (P1)
{% for feature in p1_features %}
- {{ feature.name }}: {{ feature.description }}
{% endfor %}

### 3.3 æœªæ¥è§„åˆ’ (P2)
{% for feature in p2_features %}
- {{ feature.name }}: {{ feature.description }}
{% endfor %}

---

## 4. éåŠŸèƒ½éœ€æ±‚

### 4.1 æ€§èƒ½è¦æ±‚
{% for req in performance_requirements %}
- {{ req.metric }}: {{ req.target }}
{% endfor %}

### 4.2 å®‰å…¨è¦æ±‚
{% for req in security_requirements %}
- {{ req }}
{% endfor %}

### 4.3 å¯ç”¨æ€§è¦æ±‚
{{ usability_requirements }}

---

## 5. ç”¨æˆ·ä½“éªŒè®¾è®¡

### 5.1 ç”¨æˆ·æµç¨‹
{{ user_flow }}

### 5.2 ç•Œé¢åŸå‹æè¿°
{{ ui_wireframes }}

---

## 6. æˆåŠŸæŒ‡æ ‡

### 6.1 äº§å“æŒ‡æ ‡
{% for metric in success_metrics %}
- **{{ metric.name }}**: {{ metric.target }}
{% endfor %}

### 6.2 éªŒæ”¶æ ‡å‡†
{{ acceptance_criteria }}

---

## é™„å½• A: å†³ç­–å†å²è®°å½•

{% for decision in decisions %}
### å†³ç­– {{ loop.index }}: {{ decision.topic }}
- **æ—¶é—´**: {{ decision.timestamp }}
- **å†³ç­–**: {{ decision.decision }}
- **å‚ä¸è€…**: {{ decision.participants | join(', ') }}
- **ç†ç”±**: {{ decision.reasoning }}

{% endfor %}

---

**æ–‡æ¡£ç»“æŸ**
```

---

## 5. æ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„

### 5.1 æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®åŠ è½½   â”‚  ä» YAML åŠ è½½ AgentConfig
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹åŒ–     â”‚  åˆ›å»º Agent å®ä¾‹
â”‚  (Factory)  â”‚  æ³¨å…¥ LLMProvider
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  ç­‰å¾…å‘è¨€   â”‚  Coordinator è°ƒç”¨
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºPrompt â”‚  åŸºäº AgentConfig + ä¸Šä¸‹æ–‡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  è°ƒç”¨LLM    â”‚  å¼‚æ­¥è°ƒç”¨ LLM API
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  å¤„ç†å“åº”   â”‚  è§£æã€éªŒè¯ã€æ ¼å¼åŒ–
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ç»“æœ   â”‚  ä¿å­˜åˆ° Session
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ™ºèƒ½ä½“é€šä¿¡æœºåˆ¶

```python
class AgentCommunicationProtocol:
    """æ™ºèƒ½ä½“é€šä¿¡åè®®"""

    async def agent_to_agent(
        self,
        from_agent: str,
        to_agent: str,
        message: str
    ) -> str:
        """æ™ºèƒ½ä½“ä¹‹é—´çš„é€šä¿¡"""
        # åœºæ™¯ï¼šæŠ€æœ¯ä¸“å®¶å¼•ç”¨äº§å“ç»ç†çš„è¯
        # "åŒæ„äº§å“ç»ç†çš„å»ºè®®ï¼ŒåŸºäºè¿™ä¸ªéœ€æ±‚..."

        # å®ç°æ–¹å¼ï¼š
        # 1. åœ¨å¯¹è¯å†å²ä¸­æ ‡è®°å‘è¨€è€…
        # 2. åœ¨ system prompt ä¸­å…è®¸å¼•ç”¨
        # 3. æä¾› @mention æœºåˆ¶ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰

        pass

    async def broadcast(
        self,
        from_agent: str,
        message: str
    ) -> List[str]:
        """å¹¿æ’­æ¶ˆæ¯ï¼ˆ"å…¨éƒ¨å‘è¨€"åœºæ™¯ï¼‰"""
        # å¹¶å‘è°ƒç”¨æ‰€æœ‰æ™ºèƒ½ä½“
        responses = await asyncio.gather(
            *[agent.generate(message) for agent in agents]
        )
        return responses
```

### 5.3 ä¸Šä¸‹æ–‡ç®¡ç†ç­–ç•¥

**é—®é¢˜**: å¯¹è¯è¿‡é•¿ï¼Œè¶…å‡º LLM ä¸Šä¸‹æ–‡çª—å£

**è§£å†³æ–¹æ¡ˆ**:

```python
class ContextManager:
    """ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""

    def __init__(self, max_tokens: int = 4000):
        self.max_tokens = max_tokens

    async def prepare_context(
        self,
        session: Session,
        agent: Agent
    ) -> List[Message]:
        """å‡†å¤‡ä¸Šä¸‹æ–‡ï¼ˆå‹ç¼©ç­–ç•¥ï¼‰"""

        # ç­–ç•¥ 1: åªä¿ç•™æœ€è¿‘ N æ¡æ¶ˆæ¯
        recent_messages = session.messages[-10:]

        # ç­–ç•¥ 2: ç”Ÿæˆæ‘˜è¦ï¼ˆå¦‚æœæ¶ˆæ¯å¤ªå¤šï¼‰
        if len(session.messages) > 20:
            summary = await self._generate_summary(session)
            return [summary] + recent_messages

        # ç­–ç•¥ 3: è¿‡æ»¤ä¸é‡è¦çš„æ¶ˆæ¯
        important_messages = self._filter_important(session.messages)

        return important_messages

    async def _generate_summary(self, session: Session) -> Message:
        """ç”Ÿæˆå¯¹è¯æ‘˜è¦"""
        # ä½¿ç”¨ LLM ç”Ÿæˆæ‘˜è¦
        prompt = f"""
        è¯·ä¸ºä»¥ä¸‹å¯¹è¯ç”Ÿæˆæ‘˜è¦ï¼ˆ200 å­—ä»¥å†…ï¼‰ï¼š
        {self._format_conversation(session)}

        æ‘˜è¦åº”åŒ…å«ï¼š
        1. äº§å“åç§°å’Œç›®æ ‡
        2. å·²ç¡®å®šçš„éœ€æ±‚
        3. å·²åšå‡ºçš„å†³ç­–
        """

        summary_text = await self.llm.generate(prompt)

        return Message(
            role="system",
            content=f"[å¯¹è¯æ‘˜è¦] {summary_text}"
        )

    def _filter_important(self, messages: List[Message]) -> List[Message]:
        """è¿‡æ»¤é‡è¦æ¶ˆæ¯"""
        # ä¿ç•™ï¼š
        # - ç”¨æˆ·çš„æ¶ˆæ¯
        # - æ™ºèƒ½ä½“çš„å…³é”®æé—®
        # - å†³ç­–ç›¸å…³çš„æ¶ˆæ¯

        important = []
        for msg in messages:
            if msg.role == "user":
                important.append(msg)
            elif "?" in msg.content or "ç¡®å®š" in msg.content or "å†³ç­–" in msg.content:
                important.append(msg)

        return important
```

---

## 6. API æ¥å£è®¾è®¡

### 6.1 å†…éƒ¨æ¨¡å—æ¥å£

#### 6.1.1 SessionManager æ¥å£

```python
class ISessionManager(ABC):
    """ä¼šè¯ç®¡ç†å™¨æ¥å£"""

    @abstractmethod
    async def create_session(self, product_name: str) -> Session:
        """åˆ›å»ºæ–°ä¼šè¯"""
        pass

    @abstractmethod
    async def get_session(self, session_id: str) -> Optional[Session]:
        """è·å–ä¼šè¯"""
        pass

    @abstractmethod
    async def update_session(self, session: Session) -> None:
        """æ›´æ–°ä¼šè¯"""
        pass

    @abstractmethod
    async def delete_session(self, session_id: str) -> None:
        """åˆ é™¤ä¼šè¯"""
        pass

    @abstractmethod
    async def list_sessions(self) -> List[Session]:
        """åˆ—å‡ºæ‰€æœ‰ä¼šè¯"""
        pass
```

#### 6.1.2 LLMProvider æ¥å£

```python
class LLMProvider(ABC):
    """LLM æä¾›å•†æ¥å£"""

    @abstractmethod
    async def generate(
        self,
        prompt: str,
        max_tokens: int = 2000,
        temperature: float = 0.7
    ) -> str:
        """ç”Ÿæˆæ–‡æœ¬"""
        pass

    @abstractmethod
    async def generate_stream(
        self,
        prompt: str,
        max_tokens: int = 2000,
        temperature: float = 0.7
    ) -> AsyncIterator[str]:
        """æµå¼ç”Ÿæˆæ–‡æœ¬"""
        pass

    @abstractmethod
    def count_tokens(self, text: str) -> int:
        """è®¡ç®— Token æ•°é‡"""
        pass
```

### 6.2 å¤–éƒ¨ APIï¼ˆV2 Web ç‰ˆï¼‰

**RESTful API è®¾è®¡**ï¼ˆV2.0 è§„åˆ’ï¼‰:

```yaml
# API åŸºç¡€
base_url: "http://localhost:8000/api/v1"

# ç«¯ç‚¹
sessions:
  POST   /sessions              # åˆ›å»ºä¼šè¯
  GET    /sessions              # åˆ—å‡ºä¼šè¯
  GET    /sessions/{id}         # è·å–ä¼šè¯è¯¦æƒ…
  PUT    /sessions/{id}         # æ›´æ–°ä¼šè¯
  DELETE /sessions/{id}         # åˆ é™¤ä¼šè¯

messages:
  POST   /sessions/{id}/messages        # å‘é€æ¶ˆæ¯
  GET    /sessions/{id}/messages        # è·å–æ¶ˆæ¯å†å²

agents:
  GET    /agents                        # åˆ—å‡ºæ‰€æœ‰æ™ºèƒ½ä½“
  POST   /sessions/{id}/agents/{name}   # è®©æŒ‡å®šæ™ºèƒ½ä½“å‘è¨€

documents:
  POST   /sessions/{id}/documents/prd   # ç”Ÿæˆ PRD
  POST   /sessions/{id}/documents/tech  # ç”ŸæˆæŠ€æœ¯è®¾è®¡
  GET    /sessions/{id}/documents/preview  # å®æ—¶é¢„è§ˆ
```

**ç¤ºä¾‹ä»£ç ï¼ˆFastAPIï¼‰**:

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI(title="CWord API")

class MessageRequest(BaseModel):
    content: str
    agent_name: Optional[str] = None

@app.post("/api/v1/sessions/{session_id}/messages")
async def send_message(
    session_id: str,
    request: MessageRequest
):
    """å‘é€æ¶ˆæ¯"""
    session = await session_manager.get_session(session_id)
    if not session:
        raise HTTPException(status_code=404, detail="Session not found")

    if request.agent_name:
        # è®©æŒ‡å®šæ™ºèƒ½ä½“å‘è¨€
        response = await coordinator.let_agent_speak(
            request.agent_name,
            session
        )
    else:
        # ç”¨æˆ·æ¶ˆæ¯
        message = Message(role="user", content=request.content)
        session.add_message(message)

        # æ™ºèƒ½å»ºè®®
        suggestions = await coordinator.suggest_agents(session)

    return {
        "response": response,
        "suggestions": suggestions,
        "session": session.to_dict()
    }
```

---

## 7. æ–‡æ¡£ç”Ÿæˆå¼•æ“è®¾è®¡

### 7.1 å®æ—¶é¢„è§ˆæœºåˆ¶

```python
class RealtimePreviewGenerator:
    """å®æ—¶é¢„è§ˆç”Ÿæˆå™¨"""

    def __init__(self, document_generator: DocumentGenerator):
        self.doc_gen = document_generator

    async def update_preview(self, session: Session):
        """æ›´æ–°é¢„è§ˆï¼ˆå¢é‡æ›´æ–°ï¼‰"""
        # æ¯æ¬¡å¯¹è¯åè‡ªåŠ¨æ›´æ–°
        preview = await self.doc_gen.generate_realtime_preview(session)

        # ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶
        preview_path = Path.home() / ".cword" / "preview.md"
        preview_path.write_text(preview)

        return preview_path

    async def watch_changes(self, session: Session):
        """ç›‘å¬ä¼šè¯å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°é¢„è§ˆ"""
        async for event in self.event_bus.subscribe("message_added"):
            await self.update_preview(session)
```

### 7.2 æ¨¡æ¿ç»§æ‰¿æœºåˆ¶

**åŸºç¡€æ¨¡æ¿**ï¼ˆbase.mdï¼‰:
```markdown
# {{ product_name }} {{ document_type }}

**ç”Ÿæˆæ—¶é—´**: {{ generated_at }}
**ç”Ÿæˆå·¥å…·**: CWord v{{ version }}

{% block content %}{% endblock %}

---

## é™„å½•

{% block appendix %}{% endblock %}
```

**PRD æ¨¡æ¿**ï¼ˆprd.mdï¼‰:
```markdown
{% extends "base.md" %}

{% block content %}
## 1. äº§å“æ¦‚è¿°
{{ product_overview }}

## 2. åŠŸèƒ½éœ€æ±‚
{{ features }}
{% endblock %}

{% block appendix %}
### å†³ç­–å†å²
{% for decision in decisions %}
- {{ decision.topic }}: {{ decision.decision }}
{% endfor %}
{% endblock %}
```

### 7.3 æ–‡æ¡£ç”Ÿæˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šè¯æ•°æ®     â”‚  Session (messages, decisions)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿¡æ¯æå–     â”‚  ä½¿ç”¨ LLM æå–ç»“æ„åŒ–ä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»„ç»‡å†…å®¹     â”‚  åˆ†ç±»ã€æ’åºã€å…³è”
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸²æŸ“æ¨¡æ¿     â”‚  Jinja2 æ¸²æŸ“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åå¤„ç†       â”‚  Markdown æ ¼å¼åŒ–
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å‡ºæ–‡ä»¶     â”‚  ä¿å­˜åˆ° .cword/output/
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–

### 8.1 å®‰å…¨è®¾è®¡

#### 8.1.1 API Key ç®¡ç†

```python
from cryptography.fernet import Fernet

class SecureConfigStore:
    """å®‰å…¨é…ç½®å­˜å‚¨"""

    def __init__(self, encryption_key: bytes):
        self.cipher = Fernet(encryption_key)

    def save_api_key(self, provider: str, api_key: str):
        """åŠ å¯†ä¿å­˜ API Key"""
        encrypted = self.cipher.encrypt(api_key.encode())
        config_file = Path.home() / ".cword" / "credentials.enc"
        # ä¿å­˜åŠ å¯†åçš„å¯†é’¥
        ...

    def load_api_key(self, provider: str) -> str:
        """è§£å¯†åŠ è½½ API Key"""
        encrypted = self._read_encrypted(provider)
        decrypted = self.cipher.decrypt(encrypted)
        return decrypted.decode()

    @staticmethod
    def generate_key() -> bytes:
        """ç”ŸæˆåŠ å¯†å¯†é’¥"""
        return Fernet.generate_key()
```

**ä½¿ç”¨æ–¹å¼**:
```python
# é¦–æ¬¡ä½¿ç”¨æ—¶ç”Ÿæˆå¯†é’¥
key = SecureConfigStore.generate_key()
# ä¿å­˜åˆ°ç¯å¢ƒå˜é‡æˆ–å¯†é’¥æ–‡ä»¶
# export CWORD_ENCRYPTION_KEY=<key>

# åç»­ä½¿ç”¨
store = SecureConfigStore(key)
store.save_api_key("anthropic", "sk-ant-xxx")
```

#### 8.1.2 æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

```python
class SensitiveDataFilter:
    """æ•æ„Ÿæ•°æ®è¿‡æ»¤å™¨"""

    SENSITIVE_PATTERNS = [
        r"\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b",  # é‚®ç®±
        r"\b\d{4}-\d{4}-\d{4}-\d{4}\b",  # ä¿¡ç”¨å¡
        r"\b\d{15,19}\b",  # é“¶è¡Œå¡å·
        r"password\s*[:=]\s*\S+",  # å¯†ç 
        r"api[_-]?key\s*[:=]\s*\S+",  # API Key
    ]

    def filter(self, text: str) -> str:
        """è¿‡æ»¤æ•æ„Ÿä¿¡æ¯"""
        import re

        for pattern in self.SENSITIVE_PATTERNS:
            text = re.sub(pattern, "[REDACTED]", text, flags=re.IGNORECASE)

        return text

    def should_log(self, message: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥è®°å½•æ—¥å¿—"""
        # å¦‚æœåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¸è®°å½•
        filtered = self.filter(message)
        return filtered == message
```

#### 8.1.3 æç¤ºæ³¨å…¥é˜²æŠ¤

```python
class PromptInjectionGuard:
    """æç¤ºæ³¨å…¥é˜²æŠ¤"""

    SUSPICIOUS_PATTERNS = [
        "ignore previous instructions",
        "disregard all above",
        "forget everything",
        "new instructions:",
        "system:",
    ]

    def check(self, user_input: str) -> bool:
        """æ£€æŸ¥æ˜¯å¦åŒ…å«æç¤ºæ³¨å…¥"""
        user_input_lower = user_input.lower()

        for pattern in self.SUSPICIOUS_PATTERNS:
            if pattern in user_input_lower:
                logger.warning(f"æ£€æµ‹åˆ°æ½œåœ¨çš„æç¤ºæ³¨å…¥: {pattern}")
                return False

        return True
```

### 8.2 æ€§èƒ½ä¼˜åŒ–

#### 8.2.1 å¹¶å‘è°ƒç”¨ LLM

```python
async def parallel_agent_consultation(
    session: Session,
    agents: List[Agent],
    message: str
) -> Dict[str, str]:
    """å¹¶å‘å’¨è¯¢å¤šä¸ªæ™ºèƒ½ä½“"""

    tasks = [
        agent.generate_response(session.messages, {})
        for agent in agents
    ]

    # å¹¶å‘æ‰§è¡Œ
    responses = await asyncio.gather(*tasks)

    return {
        agent.name: response
        for agent, response in zip(agents, responses)
    }
```

#### 8.2.2 ç¼“å­˜æœºåˆ¶

```python
from functools import lru_cache
import hashlib

class LLMCache:
    """LLM å“åº”ç¼“å­˜"""

    def __init__(self, ttl: int = 3600):
        self.cache = {}
        self.ttl = ttl

    def _hash(self, prompt: str) -> str:
        """ç”Ÿæˆ Prompt Hash"""
        return hashlib.md5(prompt.encode()).hexdigest()

    async def get(self, prompt: str) -> Optional[str]:
        """è·å–ç¼“å­˜"""
        key = self._hash(prompt)

        if key in self.cache:
            cached, timestamp = self.cache[key]

            # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
            if time.time() - timestamp < self.ttl:
                return cached

        return None

    async def set(self, prompt: str, response: str):
        """è®¾ç½®ç¼“å­˜"""
        key = self._hash(prompt)
        self.cache[key] = (response, time.time())
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# åœ¨ Agent ä¸­ä½¿ç”¨ç¼“å­˜
class CachedAgent(Agent):
    def __init__(self, config, llm_provider, cache):
        super().__init__(config, llm_provider)
        self.cache = cache

    async def generate_response(self, messages, context):
        prompt = self.build_prompt(messages)

        # å…ˆæŸ¥ç¼“å­˜
        cached = await self.cache.get(prompt)
        if cached:
            return cached

        # è°ƒç”¨ LLM
        response = await self.llm.generate(prompt)

        # å­˜å…¥ç¼“å­˜
        await self.cache.set(prompt, response)

        return response
```

#### 8.2.3 æµå¼è¾“å‡º

```python
async def stream_response(llm_provider, prompt: str):
    """æµå¼è¾“å‡ºå“åº”"""
    console = Console()

    with console.status("[bold green]æ€è€ƒä¸­...", spinner="dots"):
        async for chunk in llm_provider.generate_stream(prompt):
            # å®æ—¶æ˜¾ç¤º
            console.print(chunk, end="")

    console.print()  # æ¢è¡Œ
```

---

## 9. éƒ¨ç½²æ–¹æ¡ˆ

### 9.1 å®‰è£…æ–¹å¼

#### 9.1.1 pip å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# ç”¨æˆ·å®‰è£…
pip install cword

# åˆå§‹åŒ–é…ç½®
cword --init

# è®¾ç½® API Key
export ANTHROPIC_API_KEY="sk-ant-xxx"

# å¯åŠ¨
cword
```

#### 9.1.2 Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

```dockerfile
# Dockerfile
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY .. .

# å®‰è£…
RUN pip install -e .

# åˆ›å»ºç›®å½•
RUN mkdir -p /root/.cword/{sessions,logs,output}

ENTRYPOINT ["cword"]
```

```bash
# æ„å»ºé•œåƒ
docker build -t cword:latest .

# è¿è¡Œ
docker run -it \
  -v ~/.cword:/root/.cword \
  -e ANTHROPIC_API_KEY="sk-ant-xxx" \
  cword:latest
```

### 9.2 ç›®å½•ç»“æ„

```
~/.cword/                      # ä¸»ç›®å½•
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ cword.yaml             # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ agents.yaml            # æ™ºèƒ½ä½“é…ç½®
â”‚   â””â”€â”€ credentials.enc        # åŠ å¯†çš„ API Keyï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ sessions/                   # ä¼šè¯å­˜å‚¨
â”‚   â”œâ”€â”€ session_001.json
â”‚   â””â”€â”€ session_002.json
â”œâ”€â”€ logs/                       # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ cword_20250204.log
â”‚   â””â”€â”€ error.log
â”œâ”€â”€ output/                     # ç”Ÿæˆçš„æ–‡æ¡£
â”‚   â”œâ”€â”€ äº§å“A_PRD.md
â”‚   â””â”€â”€ äº§å“A_æŠ€æœ¯è®¾è®¡.md
â”œâ”€â”€ templates/                  # ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿
â”‚   â”œâ”€â”€ prd_template.md
â”‚   â””â”€â”€ tech_spec_template.md
â””â”€â”€ preview.md                  # å®æ—¶é¢„è§ˆï¼ˆä¸´æ—¶æ–‡ä»¶ï¼‰
```

### 9.3 é…ç½®ç®¡ç†

#### 9.3.1 ç¯å¢ƒå˜é‡

```bash
# .env æ–‡ä»¶
ANTHROPIC_API_KEY=sk-ant-xxx
OPENAI_API_KEY=sk-openai-xxx
CWORD_LOG_LEVEL=INFO
CWORD_MAX_TOKENS=2000
CWORD_ENCRYPTION_KEY=xxx  # å¯é€‰ï¼Œç”¨äºåŠ å¯† API Key
```

#### 9.3.2 å¤šç¯å¢ƒé…ç½®

```yaml
# config/cword.yaml

# å¼€å‘ç¯å¢ƒ
development:
  log_level: "DEBUG"
  cache_enabled: false

# ç”Ÿäº§ç¯å¢ƒ
production:
  log_level: "INFO"
  cache_enabled: true
  auto_save: true
```

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•

```python
# tests/test_agents.py
import pytest
from src.agents.built_in import ProductManagerAgent

@pytest.fixture
def mock_llm():
    """Mock LLM Provider"""
    class MockLLM:
        async def generate(self, prompt: str) -> str:
            return "è¿™æ˜¯äº§å“ç»ç†çš„å›å¤"
    return MockLLM()

@pytest.mark.asyncio
async def test_product_manager_agent(mock_llm):
    """æµ‹è¯•äº§å“ç»ç†æ™ºèƒ½ä½“"""
    config = AgentConfig({
        "name": "äº§å“ç»ç†",
        "role": "product_manager",
        "description": "æµ‹è¯•",
        "system_prompt": "ä½ æ˜¯äº§å“ç»ç†",
        "model": {}
    })

    agent = ProductManagerAgent(config, mock_llm)

    response = await agent.generate_response([], {})

    assert response == "è¿™æ˜¯äº§å“ç»ç†çš„å›å¤"
```

### 10.2 é›†æˆæµ‹è¯•

```python
# tests/test_coordinator.py
import pytest
from src.core.coordinator import AgentCoordinator

@pytest.mark.asyncio
async def test_full_conversation_flow():
    """æµ‹è¯•å®Œæ•´å¯¹è¯æµç¨‹"""
    # 1. åˆ›å»ºä¼šè¯
    session = await session_manager.create_session("æµ‹è¯•äº§å“")

    # 2. ç”¨æˆ·å‘é€æ¶ˆæ¯
    session.add_message(Message(
        role="user",
        content="æˆ‘æƒ³åšä¸ªå¾…åŠæ¸…å•åº”ç”¨"
    ))

    # 3. äº§å“ç»ç†å‘è¨€
    response = await coordinator.let_agent_speak("äº§å“ç»ç†", session)

    # 4. éªŒè¯
    assert len(session.messages) == 2  # ç”¨æˆ· + äº§å“ç»ç†
    assert "äº§å“ç»ç†" in response

    # 5. ç”Ÿæˆæ–‡æ¡£
    prd = await doc_generator.generate_prd(session)
    assert "# æµ‹è¯•äº§å“ äº§å“éœ€æ±‚æ–‡æ¡£" in prd
```

### 10.3 ç«¯åˆ°ç«¯æµ‹è¯•

```python
# tests/test_e2e.py
import pytest
from subprocess import Popen, PIPE
import time

@pytest.mark.e2e
def test_cli_session():
    """æµ‹è¯• CLI å®Œæ•´æµç¨‹"""
    # å¯åŠ¨ CWord
    proc = Popen(
        ["cword"],
        stdin=PIPE,
        stdout=PIPE,
        stderr=PIPE,
        text=True
    )

    # å‘é€è¾“å…¥
    inputs = [
        "æˆ‘æƒ³åšä¸ªå¾…åŠæ¸…å•\n",
        "1\n",  # é€‰æ‹©äº§å“ç»ç†
        "ä¸ªäººä½¿ç”¨\n",
        "/export\n",
        "/exit\n"
    ]

    for inp in inputs:
        proc.stdin.write(inp)
        proc.stdin.flush()
        time.sleep(1)

    # éªŒè¯è¾“å‡º
    output = proc.stdout.read()
    assert "äº§å“éœ€æ±‚æ–‡æ¡£" in output

    proc.terminate()
```

---

## 11. å¼€å‘è§„èŒƒ

### 11.1 ä»£ç é£æ ¼

```python
# ä½¿ç”¨ Black æ ¼å¼åŒ–
# black src/

# ä½¿ç”¨ isort æ’åº imports
# isort src/

# ä½¿ç”¨ mypy ç±»å‹æ£€æŸ¥
# mypy src/

# ä½¿ç”¨ pylint ä»£ç æ£€æŸ¥
# pylint src/
```

### 11.2 Git å·¥ä½œæµ

```bash
# åŠŸèƒ½å¼€å‘
git checkout -b feature/add-ux-designer-agent
git commit -m "feat: add UX designer agent"

# ä¿®å¤ Bug
git checkout -b fix/fix-context-overflow
git commit -m "fix: resolve context overflow issue"

# æ–‡æ¡£
git commit -m "docs: update API documentation"
```

### 11.3 ç‰ˆæœ¬ç®¡ç†

```
v1.0.0    # MVP
v1.0.1    # Bug fix
v1.1.0    # æ–°åŠŸèƒ½ï¼ˆä¸ç ´åå‘åå…¼å®¹ï¼‰
v2.0.0    # ç ´åæ€§å˜æ›´
```

---

## 12. ç›‘æ§ä¸æ—¥å¿—

### 12.1 æ—¥å¿—ç­–ç•¥

```python
from loguru import logger

# é…ç½®æ—¥å¿—
logger.add(
    ".cword/logs/cword_{time}.log",
    rotation="10 MB",
    retention="30 days",
    level="INFO",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level} | {message}"
)

# ä½¿ç”¨æ—¥å¿—
logger.info("ä¼šè¯åˆ›å»º", session_id=session_id)
logger.error("LLM API è°ƒç”¨å¤±è´¥", error=str(e))
```

### 12.2 æ€§èƒ½ç›‘æ§

```python
import time

class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§"""

    def __init__(self):
        self.metrics = {}

    async def track_llm_call(self, provider: str, model: str):
        """è·Ÿè¸ª LLM è°ƒç”¨"""
        start = time.time()

        yield  # æ‰§è¡Œ LLM è°ƒç”¨

        duration = time.time() - start

        logger.info(
            f"LLM è°ƒç”¨: {provider}/{model}",
            duration=f"{duration:.2f}s"
        )

        # è®°å½•åˆ° Prometheusï¼ˆå¯é€‰ï¼‰
        # prometheus_counter.labels(provider=provider, model=model).inc()
```

---

## 13. æŠ€æœ¯é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| LLM API é™æµ/å®•æœº | é«˜ | ä¸­ | å®ç°é‡è¯•æœºåˆ¶ã€æ”¯æŒå¤šä¸ª Provider |
| ä¸Šä¸‹æ–‡æº¢å‡º | é«˜ | é«˜ | å®ç°æ‘˜è¦æœºåˆ¶ã€æ™ºèƒ½è£å‰ª |
| API Key æ³„éœ² | é«˜ | ä½ | åŠ å¯†å­˜å‚¨ã€ç¯å¢ƒå˜é‡ |
| ç”Ÿæˆå†…å®¹è´¨é‡ä¸ç¨³å®š | ä¸­ | ä¸­ | ä¼˜åŒ– Promptã€äººå·¥å®¡æ ¸ |
| æˆæœ¬è¿‡é«˜ï¼ˆLLM è°ƒç”¨ï¼‰ | ä¸­ | ä¸­ | å®ç°ç¼“å­˜ã€ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹ |

---

## 14. åç»­æŠ€æœ¯æ¼”è¿›

### 14.1 V1.0 â†’ V1.1

- [ ] æ™ºèƒ½ä½“å¸‚åœºï¼ˆæ’ä»¶ç³»ç»Ÿï¼‰
- [ ] Web UIï¼ˆFastAPI + Vue.jsï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒ

### 14.2 V1.1 â†’ V2.0

- [ ] å¤šç”¨æˆ·åä½œ
- [ ] ç‰ˆæœ¬æ§åˆ¶ï¼ˆé›†æˆ Gitï¼‰
- [ ] ä¸€é”®éƒ¨ç½²ï¼ˆVercel/Railwayï¼‰

### 14.3 é•¿æœŸæ„¿æ™¯

- [ ] æœ¬åœ° LLM æ”¯æŒï¼ˆOllamaï¼‰
- [ ] AI ä»£ç ç”Ÿæˆï¼ˆåŸºäº PRDï¼‰
- [ ] é›†æˆ GitHub CI/CD

---

## 15. æ€»ç»“

æœ¬ç³»ç»Ÿè®¾è®¡æ–‡æ¡£è¯¦ç»†å®šä¹‰äº† CWord çš„æŠ€æœ¯æ¶æ„ï¼Œæ ¸å¿ƒäº®ç‚¹ï¼š

âœ… **æ¨¡å—åŒ–è®¾è®¡**: åˆ†å±‚æ¶æ„ï¼ŒèŒè´£æ¸…æ™°
âœ… **å¯æ‰©å±•æ€§**: æ’ä»¶åŒ–æ™ºèƒ½ä½“ï¼Œæ˜“äºæ‰©å±•
âœ… **å®‰å…¨æ€§**: API Key åŠ å¯†ï¼Œæ•æ„Ÿä¿¡æ¯è¿‡æ»¤
âœ… **æ€§èƒ½ä¼˜åŒ–**: å¹¶å‘è°ƒç”¨ï¼Œç¼“å­˜æœºåˆ¶
âœ… **å¯ç»´æŠ¤æ€§**: å®Œå–„çš„æµ‹è¯•ï¼Œè§„èŒƒçš„ä»£ç 

**æŠ€æœ¯æ ˆæ€»ç»“**:
- **è¯­è¨€**: Python 3.10+
- **LLM**: Anthropic Claude, OpenAI GPT-4
- **CLI**: Rich, Questionary
- **æ¨¡æ¿**: Jinja2
- **å­˜å‚¨**: JSON + YAML
- **æµ‹è¯•**: pytest

**é¢„æœŸæ€§èƒ½**:
- å“åº”æ—¶é—´: < 3 ç§’
- å¹¶å‘æ”¯æŒ: å•ç”¨æˆ·ï¼ˆV1.0ï¼‰
- ç¨³å®šæ€§: è¿ç»­ 50 è½®å¯¹è¯æ— å´©æºƒ

---

**æ–‡æ¡£ç»“æŸ**
